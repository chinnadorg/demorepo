name: Rollback to Release Tag

on:
  workflow_dispatch:
    inputs:
      tag:
        description: "Tag to Rollback To (example: Release_V2)"
        required: true
        type: string

permissions:
  contents: write
  packages: read

jobs:
  rollback:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Validate selected tag
        env:
          TAG: ${{ github.event.inputs.tag }}
          REPO: ${{ github.repository }}
        run: |
          REPO_URL="https://github.com/$REPO.git"

          echo "Checking if tag '$TAG' exists on $REPO_URL"

          if ! git ls-remote --tags "$REPO_URL" | grep -q "refs/tags/$TAG"; then
            echo "Tag does not exist: $TAG"
            exit 1
          fi

          echo "Tag found!"

      - name: Deploy the rollback image
        env:
          TAG: ${{ github.event.inputs.tag }}
        run: |
          IMAGE="ghcr.io/chinnadorg/dxc-content-agent:$TAG"
          echo "Rolling back to $IMAGE"
          echo "Rollback command would run here"

